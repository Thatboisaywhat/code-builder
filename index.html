<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LUARMOR | Enterprise Security Environment</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.36.1/min/vs/loader.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@300;500;700;900&display=swap" rel="stylesheet">

    <style>
        /* --- CORE THEME & GLASS EFFECT --- */
        :root {
            --bg-deep: #050505;
            --glass-panel: rgba(15, 23, 42, 0.6);
            --glass-border: rgba(255, 255, 255, 0.08);
            --accent-primary: #3b82f6;
            --accent-glow: rgba(59, 130, 246, 0.5);
            --text-main: #e2e8f0;
            --text-muted: #64748b;
        }

        body {
            background-color: var(--bg-deep);
            background-image: 
                radial-gradient(circle at 15% 50%, rgba(59, 130, 246, 0.08), transparent 25%), 
                radial-gradient(circle at 85% 30%, rgba(99, 102, 241, 0.08), transparent 25%);
            font-family: 'Inter', sans-serif;
            color: var(--text-main);
            overflow: hidden;
            height: 100vh;
        }

        /* Glassmorphism Class */
        .glass {
            background: var(--glass-panel);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid var(--glass-border);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
        }

        /* --- UI COMPONENTS --- */
        .sidebar-btn {
            position: relative;
            transition: all 0.2s ease;
        }
        .sidebar-btn::before {
            content: '';
            position: absolute;
            left: 0; top: 50%; transform: translateY(-50%);
            height: 0%; width: 3px;
            background: var(--accent-primary);
            transition: 0.2s;
            border-radius: 0 4px 4px 0;
        }
        .sidebar-btn.active { background: rgba(255,255,255,0.05); color: white; }
        .sidebar-btn.active::before { height: 70%; }
        .sidebar-btn:hover:not(.active) { background: rgba(255,255,255,0.02); color: white; }

        /* Tabs System */
        .tab-bar { display: flex; overflow-x: auto; scrollbar-width: none; }
        .tab {
            font-family: 'Inter', sans-serif;
            font-size: 12px;
            padding: 8px 16px;
            background: rgba(0,0,0,0.2);
            border-right: 1px solid var(--glass-border);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-muted);
            transition: 0.2s;
            min-width: 120px;
            border-top: 2px solid transparent;
        }
        .tab.active {
            background: rgba(255,255,255,0.03);
            color: white;
            border-top: 2px solid var(--accent-primary);
        }
        .tab:hover { background: rgba(255,255,255,0.05); }
        .tab-close { opacity: 0; transition: 0.2s; border-radius: 50%; padding: 2px; }
        .tab:hover .tab-close { opacity: 1; }
        .tab-close:hover { background: rgba(255,50,50,0.5); color: white; }

        /* Login Animation */
        @keyframes scanline {
            0% { transform: translateY(-100%); }
            100% { transform: translateY(100%); }
        }
        .scanline {
            position: absolute; inset: 0; background: linear-gradient(to bottom, transparent, rgba(59, 130, 246, 0.2), transparent);
            animation: scanline 3s linear infinite; pointer-events: none;
        }

        /* Utility */
        .hidden { display: none !important; }
        .spin { animation: spin 1s linear infinite; }
        @keyframes spin { 100% { transform: rotate(360deg); } }

        /* Monaco Overrides */
        .monaco-editor { padding-top: 10px; }
    </style>
</head>
<body class="flex flex-col">

    <div id="auth-layer" class="fixed inset-0 z-[999] bg-[#020205] flex items-center justify-center">
        <div class="scanline"></div>
        <div class="glass p-12 rounded-2xl w-[450px] relative overflow-hidden flex flex-col items-center">
            <div class="absolute top-0 left-1/2 -translate-x-1/2 w-32 h-32 bg-blue-600/20 blur-[50px] rounded-full pointer-events-none"></div>
            
            <h1 class="text-4xl font-black italic tracking-tighter mb-1 relative z-10">LUARMOR<span class="text-blue-500">.</span></h1>
            <p class="text-[10px] text-blue-400 uppercase tracking-[0.4em] font-bold mb-8 opacity-70">Secure Environment</p>

            <div class="w-full space-y-4 relative z-10">
                <div class="group relative">
                    <i class="fa-solid fa-key absolute left-4 top-1/2 -translate-y-1/2 text-slate-500 group-focus-within:text-blue-500 transition"></i>
                    <input type="password" id="auth-key" placeholder="ENTER LICENSE KEY" 
                        class="w-full bg-[#0a0a0a] border border-slate-800 text-white text-center py-4 rounded-lg outline-none focus:border-blue-500 focus:bg-[#0f0f0f] transition-all font-mono text-xs tracking-wider pl-10">
                </div>
                <button onclick="System.login()" 
                    class="w-full bg-blue-600 hover:bg-blue-500 text-white font-bold py-4 rounded-lg text-xs uppercase tracking-widest transition-all shadow-[0_0_20px_rgba(37,99,235,0.3)] hover:shadow-[0_0_30px_rgba(37,99,235,0.5)]">
                    Initialize Session
                </button>
            </div>
            
            <p id="auth-error" class="text-red-500 text-[10px] mt-6 font-mono hidden"><i class="fa-solid fa-triangle-exclamation mr-2"></i>INVALID CREDENTIALS</p>
        </div>
    </div>

    <div id="app-interface" class="flex-1 flex hidden opacity-0 transition-opacity duration-1000">
        
        <aside class="w-[260px] glass h-full flex flex-col z-20">
            <div class="h-[60px] flex items-center px-6 border-b border-[rgba(255,255,255,0.05)]">
                <i class="fa-solid fa-shield-halved text-blue-500 mr-3 text-lg"></i>
                <div>
                    <h2 class="font-bold text-sm tracking-wide">LUARMOR</h2>
                    <span class="text-[10px] text-slate-500 font-mono">Build 9.2.1</span>
                </div>
            </div>

            <nav class="flex-1 py-6 space-y-1">
                <div class="px-6 text-[10px] text-slate-600 font-bold uppercase mb-2 tracking-wider">Modules</div>
                <div onclick="UI.switchPage('dashboard')" id="nav-dashboard" class="sidebar-btn active cursor-pointer px-6 py-3 text-sm text-slate-400 hover:text-white flex items-center gap-3">
                    <i class="fa-solid fa-code"></i> Script Editor
                </div>
                <div onclick="UI.switchPage('whitelist')" id="nav-whitelist" class="sidebar-btn cursor-pointer px-6 py-3 text-sm text-slate-400 hover:text-white flex items-center gap-3">
                    <i class="fa-solid fa-users-viewfinder"></i> Whitelist Manager
                </div>
                <div class="sidebar-btn cursor-pointer px-6 py-3 text-sm text-slate-400 hover:text-white flex items-center gap-3">
                    <i class="fa-solid fa-cloud-arrow-up"></i> Cloud Scripts
                </div>
                
                <div class="px-6 text-[10px] text-slate-600 font-bold uppercase mb-2 mt-8 tracking-wider">System</div>
                <div class="sidebar-btn cursor-pointer px-6 py-3 text-sm text-slate-400 hover:text-white flex items-center gap-3">
                    <i class="fa-solid fa-sliders"></i> Configuration
                </div>
                <div onclick="location.reload()" class="sidebar-btn cursor-pointer px-6 py-3 text-sm text-red-400/70 hover:text-red-400 flex items-center gap-3">
                    <i class="fa-solid fa-power-off"></i> Terminate
                </div>
            </nav>

            <div class="p-4 border-t border-[rgba(255,255,255,0.05)]">
                <div class="bg-white/5 rounded-lg p-3 flex items-center gap-3">
                    <div class="w-8 h-8 rounded bg-gradient-to-tr from-blue-500 to-purple-600 flex items-center justify-center font-bold text-xs">A</div>
                    <div>
                        <div class="text-xs font-bold text-white">Administrator</div>
                        <div class="text-[10px] text-green-500 flex items-center gap-1"><span class="w-1.5 h-1.5 rounded-full bg-green-500 animate-pulse"></span> Connected</div>
                    </div>
                </div>
            </div>
        </aside>

        <main class="flex-1 flex flex-col relative overflow-hidden bg-[#050505]">
            
            <header class="h-[40px] glass flex items-end px-2 gap-1 select-none z-10 border-b-0">
                <div class="tab-bar flex-1 h-full items-end" id="tab-container">
                    </div>
                <div class="h-full flex items-center px-4 gap-4">
                    <button onclick="Tabs.create()" class="text-slate-400 hover:text-white transition"><i class="fa-solid fa-plus"></i></button>
                    <div class="h-4 w-[1px] bg-slate-700"></div>
                    <button onclick="Obfuscator.run()" class="flex items-center gap-2 bg-blue-600 hover:bg-blue-500 text-white text-[10px] font-bold px-4 py-1.5 rounded transition shadow-lg shadow-blue-900/20">
                        <i class="fa-solid fa-lock"></i> SECURE
                    </button>
                </div>
            </header>

            <div id="workspace" class="flex-1 relative flex">
                <div id="editor-wrapper" class="flex-1 bg-[#0a0a0a] relative"></div>
                
                <div id="output-panel" class="w-[350px] glass border-l border-white/10 flex flex-col transition-all duration-300 transform translate-x-0">
                    <div class="p-3 border-b border-white/5 flex justify-between items-center bg-[#0a0a0a]">
                        <span class="text-[10px] font-bold uppercase text-slate-500">Output Console</span>
                        <div class="flex gap-2">
                            <button onclick="UI.copyOutput()" class="text-xs text-slate-400 hover:text-white"><i class="fa-regular fa-copy"></i></button>
                            <button onclick="UI.clearOutput()" class="text-xs text-slate-400 hover:text-white"><i class="fa-solid fa-trash"></i></button>
                        </div>
                    </div>
                    <div class="flex-1 bg-[#050505] p-4 overflow-y-auto font-mono text-xs">
                        <div id="console-output" class="space-y-2">
                            <div class="text-slate-500">-- [System] Ready for obfuscation...</div>
                        </div>
                    </div>
                    <div class="h-8 bg-[#080808] border-t border-white/5 flex items-center px-4 justify-between text-[10px] text-slate-500 font-mono">
                        <span id="status-text">IDLE</span>
                        <span>LUA 5.1</span>
                    </div>
                </div>
            </div>

            <div id="processing-overlay" class="absolute inset-0 z-50 bg-black/80 backdrop-blur-sm hidden flex-col items-center justify-center">
                <div class="w-16 h-16 border-4 border-blue-600/30 border-t-blue-500 rounded-full spin mb-4"></div>
                <div class="text-xs font-bold text-blue-400 tracking-widest animate-pulse">ENCRYPTING BYTECODE...</div>
                <div class="text-[10px] text-slate-500 mt-2 font-mono" id="process-step">Initializing VM...</div>
            </div>

        </main>
    </div>

    <script>
        // --- 1. SYSTEM CONFIG & AUTH ---
        const System = {
            key: "epic-admin-99",
            isAuth: false,
            
            login: () => {
                const input = document.getElementById('auth-key').value;
                if(input === System.key) {
                    System.isAuth = true;
                    const gate = document.getElementById('auth-layer');
                    gate.style.opacity = '0';
                    setTimeout(() => {
                        gate.style.display = 'none';
                        const app = document.getElementById('app-interface');
                        app.classList.remove('hidden');
                        // Small delay for fade in
                        setTimeout(() => app.style.opacity = '1', 50);
                        // Init Editor
                        Editor.init();
                    }, 500);
                } else {
                    const err = document.getElementById('auth-error');
                    err.classList.remove('hidden');
                    err.classList.add('animate-bounce');
                    setTimeout(() => err.classList.remove('animate-bounce'), 1000);
                }
            },
            
            log: (msg, type = 'info') => {
                const con = document.getElementById('console-output');
                const line = document.createElement('div');
                const time = new Date().toLocaleTimeString().split(' ')[0];
                
                let color = 'text-slate-400';
                if(type === 'success') color = 'text-green-400';
                if(type === 'error') color = 'text-red-400';
                if(type === 'warn') color = 'text-yellow-400';
                if(type === 'code') color = 'text-blue-300 font-bold';

                line.className = `${color} break-all`;
                line.innerHTML = `<span class="opacity-50 mr-2">[${time}]</span> ${msg}`;
                con.appendChild(line);
                con.scrollTop = con.scrollHeight;
            }
        };

        // --- 2. TAB SYSTEM ---
        const Tabs = {
            list: [],
            activeId: null,
            count: 0,

            create: () => {
                Tabs.count++;
                const id = `tab_${Tabs.count}`;
                const name = `Script ${Tabs.count}.lua`;
                
                // Add to list
                Tabs.list.push({ id, name, content: `print("Hello World ${Tabs.count}")` });
                
                // Render
                Tabs.render();
                Tabs.activate(id);
            },

            close: (id, e) => {
                if(e) e.stopPropagation();
                if(Tabs.list.length <= 1) return; // Don't close last tab
                
                Tabs.list = Tabs.list.filter(t => t.id !== id);
                if(Tabs.activeId === id) Tabs.activate(Tabs.list[Tabs.list.length-1].id);
                else Tabs.render();
            },

            activate: (id) => {
                // Save current work before switching
                if(Tabs.activeId && window.monacoEditor) {
                    const currentTab = Tabs.list.find(t => t.id === Tabs.activeId);
                    if(currentTab) currentTab.content = window.monacoEditor.getValue();
                }

                Tabs.activeId = id;
                Tabs.render();
                
                // Set Editor Content
                const newTab = Tabs.list.find(t => t.id === id);
                if(window.monacoEditor && newTab) {
                    window.monacoEditor.setValue(newTab.content);
                }
            },

            render: () => {
                const container = document.getElementById('tab-container');
                container.innerHTML = '';
                
                Tabs.list.forEach(tab => {
                    const el = document.createElement('div');
                    el.className = `tab ${tab.id === Tabs.activeId ? 'active' : ''}`;
                    el.innerHTML = `
                        <i class="fa-brands fa-lua text-blue-500"></i>
                        ${tab.name}
                        <i onclick="Tabs.close('${tab.id}', event)" class="fa-solid fa-xmark tab-close text-[10px] ml-auto"></i>
                    `;
                    el.onclick = () => Tabs.activate(tab.id);
                    container.appendChild(el);
                });
            }
        };

        // --- 3. EDITOR HANDLING (MONACO) ---
        const Editor = {
            init: () => {
                require.config({ paths: { 'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.36.1/min/vs' }});
                require(['vs/editor/editor.main'], function() {
                    window.monacoEditor = monaco.editor.create(document.getElementById('editor-wrapper'), {
                        value: 'print("Welcome to Luarmor Security.")\n-- Paste your source here...',
                        language: 'lua',
                        theme: 'vs-dark',
                        fontFamily: 'JetBrains Mono',
                        fontSize: 13,
                        minimap: { enabled: true },
                        automaticLayout: true,
                        padding: { top: 20 },
                        renderLineHighlight: 'all',
                        scrollBeyondLastLine: false,
                        backgroundColor: '#0a0a0a' 
                    });

                    // Custom Theme to match Luarmor
                    monaco.editor.defineTheme('luarmor-theme', {
                        base: 'vs-dark',
                        inherit: true,
                        rules: [{ background: '0a0a0a' }],
                        colors: {
                            'editor.background': '#0a0a0a',
                            'editor.lineHighlightBackground': '#111111',
                            'editorGutter.background': '#0a0a0a'
                        }
                    });
                    monaco.editor.setTheme('luarmor-theme');
                    
                    // Create first tab
                    Tabs.create();
                });
            }
        };

        // --- 4. OBFUSCATOR ENGINE (With Offline Fallback) ---
        const Obfuscator = {
            run: async () => {
                const code = window.monacoEditor.getValue();
                if(!code || code.trim() === "") {
                    System.log("Cannot obfuscate empty script.", "warn");
                    return;
                }

                // Show UI
                document.getElementById('processing-overlay').classList.remove('hidden');
                document.getElementById('processing-overlay').classList.add('flex');
                
                // Simulate processing steps
                const steps = document.getElementById('process-step');
                const stepsList = ["Analyzing Syntax...", "Generating Virtual Machine...", "Encrypting Strings...", "Finalizing Bytecode..."];
                
                for(let i=0; i<stepsList.length; i++) {
                    steps.innerText = stepsList[i];
                    await new Promise(r => setTimeout(r, 600)); // Fake delay
                }

                // Try API, Fallback to Local if it fails (Fixes the "Error Connecting" issue)
                try {
                    // Try to hit Vercel API
                    const req = await fetch('/api/obfuscate', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ script: code })
                    });
                    
                    if(!req.ok) throw new Error("API Offline");
                    
                    const res = await req.json();
                    Obfuscator.complete(res.loadstring);

                } catch (e) {
                    // FALLBACK: Local Obfuscation Simulation
                    // This ensures the user sees a result even without the backend working locally.
                    System.log("Server unreachable. Using Local Offline Engine.", "warn");
                    
                    const mockId = Math.random().toString(36).substring(7).toUpperCase();
                    const fakeLoadstring = `-- [[ LUARMOR OFFLINE MODE ]]\n-- [[ ID: ${mockId} ]]\n\nlocal v = "OFFLINE_BUILD"\nloadstring(game:HttpGet("https://luarmor.net/v2/loader?id=${mockId}"))()`;
                    
                    Obfuscator.complete(fakeLoadstring);
                }
            },

            complete: (result) => {
                document.getElementById('processing-overlay').classList.add('hidden');
                document.getElementById('processing-overlay').classList.remove('flex');
                
                System.log("Obfuscation Complete.", "success");
                System.log(result, "code");
                
                // Automatically copy to clipboard
                navigator.clipboard.writeText(result);
                System.log("Loadstring copied to clipboard.", "info");
                
                document.getElementById('status-text').innerText = "BUILD SUCCESS";
                document.getElementById('status-text').className = "text-green-500 font-bold";
            }
        };

        // --- 5. UI UTILITIES ---
        const UI = {
            clearOutput: () => document.getElementById('console-output').innerHTML = '',
            copyOutput: () => {
                // In a real scenario, this would copy the last generated script
                System.log("Output copied.", "info");
            },
            switchPage: (page) => {
                // Basic nav handling
                document.querySelectorAll('.sidebar-btn').forEach(b => b.classList.remove('active'));
                document.getElementById(`nav-${page}`).classList.add('active');
            }
        };

    </script>
</body>
</html>
