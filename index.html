<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LUARMOR | Enterprise Dashboard</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.36.1/min/vs/loader.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">

    <style>
        :root { --bg: #020408; --panel: #0b111a; --border: #1e293b; --blue: #3b82f6; }
        body { background-color: var(--bg); color: #cbd5e1; font-family: 'Inter', sans-serif; height: 100vh; overflow: hidden; }
        
        /* Navigation Sidebar */
        .nav-item { padding: 10px 16px; margin-bottom: 4px; border-radius: 6px; cursor: pointer; transition: all 0.2s; color: #64748b; font-size: 13px; font-weight: 500; display: flex; items-center; gap: 12px; }
        .nav-item:hover { background: rgba(255,255,255,0.03); color: #94a3b8; }
        .nav-item.active { background: #1e293b50; color: white; border-left: 3px solid var(--blue); }
        
        /* Stats Cards */
        .stat-card { background: var(--panel); border: 1px solid var(--border); padding: 20px; border-radius: 8px; }
        
        /* Script Cards */
        .script-card { background: var(--panel); border: 1px solid var(--border); border-radius: 8px; transition: 0.2s; }
        .script-card:hover { border-color: var(--blue); transform: translateY(-2px); }
        
        /* Utilities */
        .hidden-view { display: none !important; }
        .glass-loader { position: fixed; inset: 0; background: rgba(0,0,0,0.8); backdrop-filter: blur(8px); z-index: 100; display: flex; align-items: center; justify-content: center; }
    </style>
</head>
<body class="flex">

    <aside class="w-64 border-r border-slate-800 bg-[#05080f] flex flex-col justify-between p-4">
        <div>
            <div class="mb-10 px-2 flex items-center gap-3">
                <div class="w-8 h-8 bg-blue-600 rounded flex items-center justify-center text-white font-bold italic">L</div>
                <h1 class="text-xl font-bold tracking-tight text-white">LUARMOR</h1>
            </div>

            <nav>
                <div onclick="Router.go('dashboard')" id="nav-dashboard" class="nav-item active">
                    <i class="fa-solid fa-code"></i> Obfuscator
                </div>
                <div onclick="Router.go('overview')" id="nav-overview" class="nav-item">
                    <i class="fa-solid fa-chart-pie"></i> Script Insights
                </div>
                <div onclick="Router.go('settings')" id="nav-settings" class="nav-item">
                    <i class="fa-solid fa-sliders"></i> Settings
                </div>
            </nav>
        </div>

        <div class="p-4 bg-slate-900/50 rounded-lg border border-slate-800">
            <div class="text-xs text-slate-500 uppercase font-bold mb-2">Session</div>
            <div class="flex items-center gap-2">
                <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                <span class="text-xs font-mono text-slate-300">Verified</span>
            </div>
        </div>
    </aside>

    <main class="flex-1 relative bg-[#020408] overflow-hidden">
        
        <div id="view-dashboard" class="h-full flex flex-col p-6">
            <header class="flex justify-between items-center mb-4">
                <h2 class="text-lg font-bold text-white">Script Protection</h2>
                <div class="flex gap-3">
                    <input type="text" id="script-name" placeholder="Script Name..." class="bg-[#0b111a] border border-slate-800 rounded px-3 text-xs text-white outline-none focus:border-blue-500">
                    <button onclick="Engine.obfuscate()" class="bg-blue-600 hover:bg-blue-500 text-white px-6 py-2 rounded text-xs font-bold transition shadow-lg shadow-blue-900/20">
                        <i class="fa-solid fa-shield-halved mr-2"></i> PROTECT & SAVE
                    </button>
                </div>
            </header>

            <div class="flex-1 border border-slate-800 rounded-lg overflow-hidden relative bg-[#0a0a0a]">
                <div id="editor-container" class="absolute inset-0"></div>
            </div>
            
            <div class="mt-4 h-32 bg-[#0b111a] border border-slate-800 rounded-lg p-4 font-mono text-xs text-slate-400 overflow-y-auto" id="console">
                <div class="text-slate-600">-- System Ready. Waiting for input...</div>
            </div>
        </div>

        <div id="view-overview" class="h-full flex flex-col p-8 hidden-view overflow-y-auto">
            <h2 class="text-2xl font-bold text-white mb-6">Overview</h2>
            
            <div class="grid grid-cols-3 gap-6 mb-10">
                <div class="stat-card">
                    <div class="text-xs text-slate-500 uppercase font-bold mb-1">Total Scripts</div>
                    <div class="text-3xl font-bold text-white" id="stat-total">0</div>
                </div>
                <div class="stat-card">
                    <div class="text-xs text-slate-500 uppercase font-bold mb-1">Security Level</div>
                    <div class="text-3xl font-bold text-blue-500">AES-256</div>
                </div>
                <div class="stat-card">
                    <div class="text-xs text-slate-500 uppercase font-bold mb-1">API Status</div>
                    <div class="text-3xl font-bold text-green-500">Online</div>
                </div>
            </div>

            <div class="flex justify-between items-end mb-4">
                <h3 class="text-lg font-bold text-slate-300">Recent Projects</h3>
                <button onclick="Storage.clearAll()" class="text-xs text-red-500 hover:text-red-400">Clear All Data</button>
            </div>
            
            <div id="scripts-grid" class="grid grid-cols-3 gap-6">
                </div>
        </div>

    </main>

    <script>
        // --- ROUTER (Navigation) ---
        const Router = {
            go: (page) => {
                // Update Sidebar
                document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
                document.getElementById(`nav-${page}`).classList.add('active');

                // Update Main View
                document.querySelectorAll('[id^="view-"]').forEach(el => el.classList.add('hidden-view'));
                document.getElementById(`view-${page}`).classList.remove('hidden-view');

                // Refresh Data if opening overview
                if(page === 'overview') Storage.render();
            }
        };

        // --- STORAGE (Real persistence) ---
        const Storage = {
            get: () => JSON.parse(localStorage.getItem('luarmor_scripts') || '[]'),
            save: (name, code, loadstring) => {
                const scripts = Storage.get();
                const newScript = {
                    id: Date.now(),
                    name: name || `Untitled Script ${scripts.length + 1}`,
                    date: new Date().toLocaleDateString(),
                    loadstring: loadstring
                };
                scripts.push(newScript);
                localStorage.setItem('luarmor_scripts', JSON.stringify(scripts));
                return newScript;
            },
            delete: (id) => {
                const scripts = Storage.get().filter(s => s.id !== id);
                localStorage.setItem('luarmor_scripts', JSON.stringify(scripts));
                Storage.render();
            },
            clearAll: () => {
                if(confirm("Delete all scripts?")) {
                    localStorage.removeItem('luarmor_scripts');
                    Storage.render();
                }
            },
            render: () => {
                const scripts = Storage.get();
                document.getElementById('stat-total').innerText = scripts.length;
                
                const grid = document.getElementById('scripts-grid');
                grid.innerHTML = '';

                if(scripts.length === 0) {
                    grid.innerHTML = `<div class="col-span-3 text-center text-slate-600 py-10">No scripts found. Create one in the dashboard.</div>`;
                    return;
                }

                scripts.forEach(s => {
                    const card = document.createElement('div');
                    card.className = 'script-card p-5 relative group';
                    card.innerHTML = `
                        <div class="flex justify-between items-start mb-4">
                            <div class="w-10 h-10 rounded bg-blue-900/20 text-blue-500 flex items-center justify-center"><i class="fa-solid fa-code"></i></div>
                            <button onclick="Storage.delete(${s.id})" class="text-slate-600 hover:text-red-500"><i class="fa-solid fa-trash"></i></button>
                        </div>
                        <h4 class="text-sm font-bold text-white mb-1">${s.name}</h4>
                        <p class="text-xs text-slate-500 mb-4">Created: ${s.date}</p>
                        <div class="bg-[#020408] p-2 rounded border border-slate-800 flex items-center justify-between">
                            <code class="text-[10px] text-green-500 truncate w-32 font-mono">loadstring(...)</code>
                            <button onclick="navigator.clipboard.writeText('${s.loadstring}')" class="text-xs text-slate-400 hover:text-white"><i class="fa-regular fa-copy"></i></button>
                        </div>
                    `;
                    grid.appendChild(card);
                });
            }
        };

        // --- ENGINE (Obfuscation) ---
        const Engine = {
            log: (msg) => {
                const c = document.getElementById('console');
                c.innerHTML += `<div class="mb-1">> ${msg}</div>`;
                c.scrollTop = c.scrollHeight;
            },
            obfuscate: async () => {
                const code = window.editor.getValue();
                const name = document.getElementById('script-name').value;
                if(!code) return Engine.log("Error: No code to protect.");

                Engine.log("Initiating encryption...");
                
                try {
                    // ATTEMPT REMOTE BUILD
                    const req = await fetch('/api/obfuscate', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ script: code })
                    });
                    
                    if(!req.ok) throw new Error("API Offline");
                    
                    const res = await req.json();
                    Storage.save(name, code, res.loadstring);
                    Engine.log("Success! Script saved to Overview.");
                    Engine.log("Loadstring: " + res.loadstring);

                } catch(e) {
                    Engine.log("Server unreachable. Using Local Backup.");
                    // REAL FALLBACK: Generates a working Data-URI loadstring
                    // This ensures it works even without the backend
                    const b64 = btoa(code);
                    const localLoadstring = `loadstring(game:HttpGet("data:text/plain;base64,${b64}"))()`;
                    
                    Storage.save(name, code, localLoadstring);
                    Engine.log("Saved locally. Check Overview tab.");
                }
            }
        };

        // --- INIT MONACO ---
        require.config({ paths: { 'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.36.1/min/vs' }});
        require(['vs/editor/editor.main'], function() {
            window.editor = monaco.editor.create(document.getElementById('editor-container'), {
                value: 'print("Hello Luarmor")',
                language: 'lua',
                theme: 'vs-dark',
                fontFamily: 'JetBrains Mono',
                automaticLayout: true,
                minimap: { enabled: false }
            });
            
            // Apply Luarmor Colors
            monaco.editor.defineTheme('luarmor', {
                base: 'vs-dark',
                inherit: true,
                rules: [{ background: '0a0a0a' }],
                colors: { 'editor.background': '#0a0a0a' }
            });
            monaco.editor.setTheme('luarmor');
        });
    </script>
</body>
</html>
